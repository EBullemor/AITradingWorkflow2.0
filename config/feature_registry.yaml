# ===========================================
# Feature Registry
# ===========================================
# Central documentation of all features used in the system.
# Every feature must be registered here with its calculation and data dependencies.

# ----- Momentum Features -----
momentum:
  momentum_1m:
    name: "1-Month Momentum"
    description: "Log return over trailing 21 trading days"
    calculation: "log(price_t / price_t-21)"
    unit: "decimal"
    frequency: "daily"
    lookback_days: 21
    instruments: ["fx", "commodities", "btc"]
    data_fields: ["PX_LAST"]
    
  momentum_3m:
    name: "3-Month Momentum"
    description: "Log return over trailing 63 trading days"
    calculation: "log(price_t / price_t-63)"
    unit: "decimal"
    frequency: "daily"
    lookback_days: 63
    instruments: ["fx", "commodities", "btc"]
    data_fields: ["PX_LAST"]
    
  momentum_6m:
    name: "6-Month Momentum"
    description: "Log return over trailing 126 trading days"
    calculation: "log(price_t / price_t-126)"
    unit: "decimal"
    frequency: "daily"
    lookback_days: 126
    instruments: ["fx", "commodities", "btc"]
    data_fields: ["PX_LAST"]

  momentum_zscore:
    name: "Momentum Z-Score"
    description: "Standardized momentum relative to historical distribution"
    calculation: "(momentum - mean(momentum, 252)) / std(momentum, 252)"
    unit: "standard_deviations"
    frequency: "daily"
    lookback_days: 252
    instruments: ["fx", "commodities", "btc"]
    depends_on: ["momentum_1m", "momentum_3m", "momentum_6m"]

# ----- Carry Features -----
carry:
  fx_carry:
    name: "FX Carry Score"
    description: "Interest rate differential normalized by implied volatility"
    calculation: "(yield_domestic - yield_foreign) / implied_vol_3m"
    unit: "ratio"
    frequency: "daily"
    instruments: ["fx"]
    data_fields: ["FWD_CURVE", "HIST_VOL_90D"]
    notes: "Higher = more attractive carry"
    
  fx_forward_points:
    name: "Forward Points"
    description: "Difference between forward and spot rate"
    calculation: "forward_rate - spot_rate"
    unit: "pips"
    frequency: "daily"
    instruments: ["fx"]
    data_fields: ["FWD_CURVE", "PX_LAST"]

# ----- Volatility Features -----
volatility:
  realized_vol_30d:
    name: "30-Day Realized Volatility"
    description: "Annualized standard deviation of daily returns"
    calculation: "std(daily_returns, 30) * sqrt(252)"
    unit: "annualized_pct"
    frequency: "daily"
    lookback_days: 30
    instruments: ["fx", "commodities", "btc"]
    data_fields: ["PX_LAST"]
    
  realized_vol_90d:
    name: "90-Day Realized Volatility"
    description: "Annualized standard deviation of daily returns"
    calculation: "std(daily_returns, 90) * sqrt(252)"
    unit: "annualized_pct"
    frequency: "daily"
    lookback_days: 90
    instruments: ["fx", "commodities", "btc"]
    data_fields: ["PX_LAST"]
    
  vol_percentile:
    name: "Volatility Percentile"
    description: "Current vol rank vs 1-year history"
    calculation: "percentile_rank(realized_vol_30d, 252)"
    unit: "percentile"
    frequency: "daily"
    lookback_days: 252
    instruments: ["fx", "commodities", "btc"]
    depends_on: ["realized_vol_30d"]
    
  atr_14:
    name: "14-Day ATR"
    description: "Average True Range for position sizing"
    calculation: "ema(true_range, 14)"
    unit: "price"
    frequency: "daily"
    lookback_days: 14
    instruments: ["fx", "commodities", "btc"]
    data_fields: ["PX_HIGH", "PX_LOW", "PX_LAST"]

# ----- Regime Features -----
regime:
  vix_regime:
    name: "VIX Regime"
    description: "Risk-on/off classification based on VIX percentile"
    calculation: "percentile_rank(VIX, 252)"
    unit: "percentile"
    frequency: "daily"
    lookback_days: 252
    instruments: ["macro"]
    data_fields: ["VIX Index"]
    thresholds:
      risk_off: ">= 0.80"
      risk_on: "<= 0.30"
      neutral: "0.30 - 0.80"
      
  trend_regime:
    name: "Trend Regime"
    description: "Trending vs ranging market classification"
    calculation: "abs(spx_momentum_3m)"
    unit: "decimal"
    frequency: "daily"
    instruments: ["macro"]
    thresholds:
      trending: "> 0.10"
      ranging: "<= 0.05"
      transitioning: "0.05 - 0.10"

# ----- Term Structure Features (Commodities) -----
term_structure:
  roll_yield:
    name: "Roll Yield"
    description: "Annualized return from rolling front to back contract"
    calculation: "(front_price - back_price) / back_price * (365 / days_to_roll)"
    unit: "annualized_pct"
    frequency: "daily"
    instruments: ["commodities"]
    data_fields: ["CL1 Comdty", "CL4 Comdty"]
    notes: "Positive = backwardation, Negative = contango"
    
  ts_slope:
    name: "Term Structure Slope"
    description: "Percentage difference between front and back month"
    calculation: "(front_price - back_price) / back_price"
    unit: "pct"
    frequency: "daily"
    instruments: ["commodities"]
    data_fields: ["CL1 Comdty", "CL4 Comdty"]

# ----- On-Chain Features (BTC) -----
onchain:
  exchange_flow_zscore:
    name: "Exchange Flow Z-Score"
    description: "Net BTC flow to/from exchanges, standardized"
    calculation: "(net_flow - mean(net_flow, 30)) / std(net_flow, 30)"
    unit: "standard_deviations"
    frequency: "daily"
    lookback_days: 30
    instruments: ["btc"]
    data_source: "glassnode"
    notes: "Negative = outflows = bullish"
    
  mvrv_ratio:
    name: "MVRV Ratio"
    description: "Market Value to Realized Value"
    calculation: "market_cap / realized_cap"
    unit: "ratio"
    frequency: "daily"
    instruments: ["btc"]
    data_source: "glassnode"
    notes: "> 3 historically indicates overvaluation"
